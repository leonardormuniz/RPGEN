<!DOCTYPE html>
<html lang="pt-br">
<head>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" rel="stylesheet">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link rel="stylesheet" href="estilo.css">
    <title>RPGen</title>
</head>
<body>
    <div class="container-fluid full-height">
        <div class="row ">
          <div class="col-lg text-white">
            <div class="p-5" id="titulo">
              <h1>RPGen</h1>
              <h3>Inovando nas suas grandes histórias</h3>
            </div>
          </div>
          <div id="carouselExampleSlidesOnly" class="carousel slide carousel-fade col-lg-7 half-width" data-ride="carousel">
            <div class="carousel-inner">
              <div class="carousel-item active">
                <img class="d-block w-100" src="Screenshot_1.png" alt="Primeiro Slide">
              </div>
              <div class="carousel-item">
                <img class="d-block w-100" src="imagem-psd.png" alt="Segundo Slide">
              </div>
              <div class="carousel-item">
                <img class="d-block w-100" src="imagem-psd 2.png" alt="Terceiro Slide">
              </div>
            </div>
            
          </div>
        </div>
      </div>

      <div class="container-fluid full-height">
        <div class="row">
          <div class="col-lg-6">
            <div class="container">
              <form>
                  <h1>Formulário de Criação de História</h1>
      
                  <div class="section">
                      <h2>1. Definição do gênero</h2>
                      <p>Escolha um gênero:</p>
                      <select name="genero">
                          <option value="Fantasia Épica">Fantasia Épica</option>
                          <option value="Ficção Científica">Ficção Científica</option>
                          <option value="Horror">Horror</option>
                          <option value="Mistério e Investigação">Mistério e Investigação</option>
                          <option value="Ação e Aventura">Ação e Aventura</option>
                          <option value="Pós-Apocalíptico">Pós-Apocalíptico</option>
                          <option value="Superpoderes ou Super-Heróis">Superpoderes ou Super-Heróis</option>
                          <option value="Steampunk">Steampunk</option>
                          <option value="Western">Western</option>
                          <option value="Cyberpunk">Cyberpunk</option>
                          <option value="Folklore e Mitologia">Folklore e Mitologia</option>
                          
                      </select>
                  </div>
      
                  <div class="section">
                      <h2>2. Temas</h2>
                      <p>Defina um tema:</p>
                      <select name="tema">
                          <option value="Redenção">Redenção</option>
                          <option value="Sacrifício">Sacrifício</option>
                          <option value="Vingança">Vingança</option>
                          <option value="Descoberta de Identidade">Descoberta de Identidade</option>
                          <option value="Conspiração">Conspiração</option>
                          <option value="Amizade e Aliança">Amizade e Aliança</option>
                          <option value="Corrupção">Corrupção</option>
                          <option value="Natureza vs. Tecnologia">Natureza vs. Tecnologia</option>
                          <option value="Loucura e Sanidade">Loucura e Sanidade</option>
                          <option value="Guerra e Paz">Guerra e Paz</option>
                          <option value="Exploração e Descoberta">Exploração e Descoberta</option>
                          <option value="Imortalidade e Mortalidade">Imortalidade e Mortalidade</option>
                          <option value="Revolução e Rebelião">Revolução e Rebelião</option>
                          <option value="Destino e Livre Arbítrio">Destino e Livre Arbítrio</option>
                          
                      </select>
                  </div>
      
                  <div class="section">
                      <h2>3. Ambientação e mundo</h2>
                      <p>Escolha uma ambientação:</p>
                      <label>
                          <input type="radio" name="ambientacao" value="Masmorra"> Masmorra
                      </label>
      
                      <label>
                          <input type="radio" name="ambientacao" value="Navio"> Navio
                      </label>
      
                      <label>
                          <input type="radio" name="ambientacao" value="Ruínas Antigas"> Ruínas Antigas
                      </label>
      
                      <label>
                          <input type="radio" name="ambientacao" value="Estação Espacial"> Estação Espacial
                      </label>
                      
                      <label>
                          <input type="radio" name="ambientacao" value="Hospital"> Hospital
                      </label>
      
                      <label>
                          <input type="radio" name="ambientacao" value="Cemitério Assombrado"> Cemitério Assombrado
                      </label>
      
                      <label>
                          <input type="radio" name="ambientacao" value="Santuário Secreto"> Santuário Secreto
                      </label>
      
                      <label>
                          <input type="radio" name="ambientacao" value="Ruínas de uma antiga civilização"> Ruínas de uma antiga civilização
                      </label>
      
                      <label>
                          <input type="radio" name="ambientacao" value="Complexo de Cavernas Subterrâneas"> Complexo de Cavernas Subterrâneas
                      </label>
                      
                      <label>
                          <input type="radio" name="ambientacao" value="Laboratório Secreto"> Laboratório Secreto
                      </label>
      
                      <label>
                          <input type="radio" name="ambientacao" value="Bunker"> Bunker
                      </label>
      
                      <label>
                          <input type="radio" name="ambientacao" value="Igreja"> Igreja
                      </label>
      
                      <label>
                          <input type="radio" name="ambientacao" value="Torre"> Torre
                      </label>
      
                      <label>
                          <input type="radio" name="ambientacao" value="Palácio"> Palácio
                      </label>
                      <h2>4. Aspecto único do mundo</h2>
                      <p>Escolha algo único que existirá apenas nesse universo</p>
                      <label>
                          <input type="radio" name="aspecto" value="Tecnologia Específica"> Tecnologia Específica
                      </label>
      
                      <label>
                          <input type="radio" name="aspecto" value="Geografia Exótica"> Geografia Exótica
                      </label>
      
                      <label>
                          <input type="radio" name="aspecto" value="Raças ou Criaturas Únicas"> Raças ou Criaturas Únicas
                      </label>
      
                      <label>
                          <input type="radio" name="aspecto" value="Ciclo de Tempo ou Clima Único"> Ciclo de Tempo ou Clima Único
                      </label>
      
                      <label>
                          <input type="radio" name="aspecto" value="Relíquias e Artefatos especiais"> Relíquias e Artefatos especiais
                      </label>
      
                      <label>
                          <input type="radio" name="aspecto" value="Sociedade com Costumes Estranhos"> Sociedade com Costumes Estranhos
                      </label>
      
                      <label>
                          <input type="radio" name="aspecto" value="Dimensões Paralelas ou Planos Exóticos"> Dimensões Paralelas ou Planos Exóticos
                      </label>
                      
                      <label>
                          <input type="radio" name="aspecto" value="Linguagens ou Símbolos Específicos"> Linguagens ou Símbolos Específicos
                      </label>
      
                      <label>
                          <input type="radio" name="aspecto" value="Contradições na Realidade"> Contradições na Realidade
                      </label>
                  </div>
              
                  <button class="submit-button" type="submit">Enviar</button>
              </form>
              
          </div>
          <div class="col-lg-6"></div>
        </div>
      </div>
      <div class="container">
        <div class="row">
          <div class="col-lg-2"></div>
          <div class="col-lg-8">
            <div id="chat"></div>
          </div>
          <div class="col-lg-2"></div>
        </div>
      </div>


    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script type="module">


              document.querySelector('form').addEventListener('submit', async function (event) {
                  event.preventDefault();
                  let textInput = gatherFormData();
                  let resposta = await gerarResposta(textInput)
                  mostrarResposta(resposta);
              });

              async function gerarResposta(input) {
                  const requestOptions = {
                      method: 'POST',
                      headers: {
                          'Content-Type': 'application/json',
                          'Authorization': 'Bearer sk-proj-hrrHvDjL3usohCmBNGZ6T3BlbkFJ5rtDi0563p8O4X99MAP3' // Substitua com sua chave de API do OpenAI
                      },
                      body: JSON.stringify({
                          model: "gpt-3.5-turbo",
                          messages: [{ role: "user", content: input }],
                          max_tokens: 800
                      })
                  };

                  const apiUrl = 'https://api.openai.com/v1/chat/completions'; // URL da API do OpenAI

                  // Realiza a chamada fetch para a API
                  const responseStream = await fetch(apiUrl, requestOptions);
                  const reader = responseStream.body.getReader();

                  // Função para decodificar a stream de resposta em texto
                  async function readStream(reader) {
                      let result = '';
                      while (true) {
                          const { done, value } = await reader.read();
                          if (done) break;
                          result += new TextDecoder().decode(value);
                      }
                      return result;
                  }

                  const decodedResponse = await readStream(reader);
                  const parsedResponse = JSON.parse(decodedResponse);
                  console.log(parsedResponse)
                  return parsedResponse.choices[0].message.content;
              }

              function mostrarResposta(resposta) {
                  var chat = document.querySelector('#chat');
                  var chatResponse = document.createElement('div');
                  chatResponse.classList.add('chat-response'); // Adiciona a classe ao elemento
                  chat.appendChild(chatResponse);

                  // Animação de digitação
                  typeWriter(resposta, chatResponse);
              }

              function typeWriter(text, element) {
                  let i = 0;
                  const speed = 1; // Velocidade de digitação (em milissegundos)

                  function type() {
                      if (i < text.length) {
                          element.textContent += text.charAt(i);
                          i++;
                          setTimeout(type, speed);
                      }
                  }

                  type();

                  $(document).ready(function () {
                      $('.carousel').carousel({
                          interval: 800
                      });
                  });
              }

              function gatherFormData() {
                  const genero = document.querySelector('select[name="genero"]').value;
                  const tema = document.querySelector('select[name="tema"]').value;
                  const ambientacao = document.querySelector('input[name="ambientacao"]:checked').value;
                  const aspecto = document.querySelector('input[name="aspecto"]:checked').value;

                  let textInput = `Crie uma história que será usada em uma sessão one shot de RPG com o gênero de ${genero},
                  um tema que aborda ${tema} em um(a) ${ambientacao} com um(a) ${aspecto},
                  cite 4 personagens NPC importantes e diga se serão aliados ou inimigos, ao fim da história diga o qual será a
                  missão principal do grupo que estará na história, entenda que é uma história para RPG's baseados em Dungeons & Dragons,
                  dito isso incorpore no texto elementos presentes em aventuras desse universo, entenda também que os personagens que serão usados como jogadores
                  não devem ser citados, deve ser citado apenas como o grupo que será responsável pela conclusão da missão`;
                  return textInput;
              }
          </script>
</body>
</html>
